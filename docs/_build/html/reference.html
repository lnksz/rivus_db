

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reference &mdash; rivus_db 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="rivus_db 0.0.1 documentation" href="index.html"/>
        <link rel="prev" title="Introduction" href="introduction.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> rivus_db
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#entity-relations">Entity Relations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enumerated-values">Enumerated values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scripts-make-your-life-easier">Scripts - Make Your Life Easier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-create-drop">Database Create/Drop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#report-analysis">Report/Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#list-used-hub-processes">List used hub processes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-source-vertices-and-their-capacity">List source vertices and their capacity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-count-and-max-capacity-of-built-commodities">List count and max-capacity of built commodities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-report">Advanced Report</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#archive-dump-import">Archive (Dump - Import)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">rivus_db</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/reference.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reference">
<h1>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="entity-relations">
<h2>Entity Relations<a class="headerlink" href="#entity-relations" title="Permalink to this headline">¶</a></h2>
<p>The structure was created so that it is as flexible as possible regarding dimension changes.
E.g. The number of commodities, demand types etc. are normalized in 3NF.
As such it is no problem (read, you do not need to restructure the database), if at one time there is not 2 but 3 commodity types that are included in the demand per edge DataFrame.
Database structural changes are no friend of ours…</p>
<p>Change in the program part:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="36%" />
<col width="21%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Edge</th>
<th class="head">geometry</th>
<th class="head">Heat</th>
<th class="head">Elec</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>LINE</td>
<td>150</td>
<td>200</td>
</tr>
</tbody>
</table>
<p>to</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="29%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Edge</th>
<th class="head">geometry</th>
<th class="head">Heat</th>
<th class="head">Elec</th>
<th class="head">Cold</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>LINE</td>
<td>150</td>
<td>200</td>
<td>50</td>
</tr>
</tbody>
</table>
<p>Is no problem, as in the DB the edge table is separated from the demand table.
The relation is represented by a table which connects an edge with a commodity.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="27%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">edge_id</th>
<th class="head">edge</th>
<th class="head">geometry</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>12345</td>
<td>0</td>
<td>LINE</td>
</tr>
</tbody>
</table>
<p>is connected to</p>
<table border="1" class="docutils">
<colgroup>
<col width="56%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">commodity_id</th>
<th class="head">commodity</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>345</td>
<td>Heat</td>
</tr>
</tbody>
</table>
<p>through</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="44%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">edge_id</th>
<th class="head">commodity_id</th>
<th class="head">demand</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>12345</td>
<td>345</td>
<td>50</td>
</tr>
</tbody>
</table>
<p>More on normalization and normal forms <a class="reference external" href="http://www.studytonight.com/dbms/database-normalization.php">here (simple)</a>
and <a class="reference external" href="https://www.sqa.org.uk/e-learning/SoftDevRDS02CD/page_11.htm">here (detailed)</a></p>
<p>The above example shows that storing the DataFrames of the rivus model is often
not a proper solution.</p>
<p>In the following diagram you can see how the data is organised inside the database.
Besides the names, you can retrieve the respective data types too.</p>
<blockquote>
<div>Note: Some type notation follow the syntax of the <a class="reference external" href="https://github.com/adrianandrei-ca/staruml-postgresql">PSQL plug-in</a></div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Special</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>INTEGER(-1)</td>
<td>for Postgres data type SERIAL</td>
</tr>
<tr class="row-odd"><td>BIGINT(-1)</td>
<td>for Postgres data type BIGSERIAL</td>
</tr>
<tr class="row-even"><td>enum tags</td>
<td>see description in Postgres Extension</td>
</tr>
</tbody>
</table>
<img alt="_images/RivusDB.png" src="_images/RivusDB.png" />
<dl class="docutils">
<dt>Blue:</dt>
<dd>Optimization results</dd>
<dt>Gray:</dt>
<dd>Input (spatial and non-spatial)</dd>
<dt>White:</dt>
<dd>Global and extensions.</dd>
</dl>
</div>
<div class="section" id="enumerated-values">
<h2>Enumerated values<a class="headerlink" href="#enumerated-values" title="Permalink to this headline">¶</a></h2>
<p>The following columns accept only the listed values (Case Sensitive.)
Notation: <code class="docutils literal"><span class="pre">table.columns</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">run.status</span></code>:</dt>
<dd><ul class="first last simple">
<li>prepared</li>
<li>run</li>
<li>error</li>
</ul>
</dd>
<dt><code class="docutils literal"><span class="pre">run.outcome</span></code>:</dt>
<dd><ul class="first last simple">
<li>optimum,</li>
<li>optimum_not_found</li>
<li>error</li>
<li>not_run</li>
</ul>
</dd>
<dt><code class="docutils literal"><span class="pre">process_commodity.direction</span></code>:</dt>
<dd><ul class="first last simple">
<li>in</li>
<li>out</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="scripts-make-your-life-easier">
<h2>Scripts - Make Your Life Easier<a class="headerlink" href="#scripts-make-your-life-easier" title="Permalink to this headline">¶</a></h2>
<p id="scripts-anchor">Short summary of the used scripts. These scripts are shot and rich with in-line
documentation. So for detail open them up with a text editor.</p>
<div class="section" id="database-create-drop">
<h3>Database Create/Drop<a class="headerlink" href="#database-create-drop" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="file docutils literal"><span class="pre">rivus_db/sql/create_from_staruml.sh</span></code>:</dt>
<dd><ol class="first last arabic">
<li><p class="first">copies the raw scripts from <code class="file docutils literal"><span class="pre">rivus_db/sql/staruml_expor/</span></code> into <code class="file docutils literal"><span class="pre">rivus_db/sql/</span></code> and modifies them slightly</p>
<blockquote>
<div><ul class="simple">
<li>add extension handling</li>
<li>drop some generated defaults (encoding)</li>
<li>your future feature?</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">executes the modified <cite>create_*.sql</cite> scripts.</p>
</li>
<li><p class="first">if executed with <code class="docutils literal"><span class="pre">extend</span></code> argument: <code class="docutils literal"><span class="pre">create_from_staruml.sh</span> <span class="pre">extend</span></code> the 2. step is omitted. (The scripts get modified, but not executed.)</p>
</li>
</ol>
</dd>
<dt><code class="file docutils literal"><span class="pre">rivus_db/sql/_purge_rivus.sh</span></code>:</dt>
<dd><ul class="first last simple">
<li>Executes the <code class="docutils literal"><span class="pre">drop_*.sql</span></code> scripts in <code class="file docutils literal"><span class="pre">rivus_db/sql/</span></code></li>
</ul>
</dd>
<dt><code class="file docutils literal"><span class="pre">rivus_db/reset_db.sh</span></code>:</dt>
<dd><ul class="first last simple">
<li>Executes the above two scripts after each other. This results in a clean new database.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="report-analysis">
<span id="a-queries"></span><h3>Report/Analysis<a class="headerlink" href="#report-analysis" title="Permalink to this headline">¶</a></h3>
<p>I have a work-flow, where I narrow down the large data set with some SQL queries on the database
client (DBeaver, plsq…). Typically, from those results I can pick 1-5 runs which are really interesting.
I can investigate them further with <code class="docutils literal"><span class="pre">rivus</span></code> functions.</p>
<p>Some of the scripts are enlightened here for inspiration:</p>
<div class="section" id="list-used-hub-processes">
<h4>List used hub processes<a class="headerlink" href="#list-used-hub-processes" title="Permalink to this headline">¶</a></h4>
<p>Entry level query, join the relevant tables, filter data. Get the used processes.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Built processes (no hubs) and their capacity.</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_num</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">KP</span><span class="o">.</span><span class="n">capacity</span>
<span class="kn">from</span> <span class="nn">kappa_process</span> <span class="k">as</span> <span class="n">KP</span>
<span class="n">join</span> <span class="n">vertex</span> <span class="k">as</span> <span class="n">V</span> <span class="n">on</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_id</span><span class="o">=</span><span class="n">KP</span><span class="o">.</span><span class="n">vertex_id</span>
<span class="n">join</span> <span class="n">process</span> <span class="k">as</span> <span class="n">P</span> <span class="n">on</span> <span class="n">P</span><span class="o">.</span><span class="n">process_id</span><span class="o">=</span><span class="n">KP</span><span class="o">.</span><span class="n">process_id</span>
<span class="n">where</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span> <span class="o">&gt;</span> <span class="mi">1200</span> <span class="o">--</span><span class="n">V</span><span class="o">.</span><span class="n">run_id</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4825</span><span class="p">,</span> <span class="mi">4833</span><span class="p">)</span> <span class="o">--</span> <span class="k">for</span> <span class="n">local</span>
	<span class="ow">and</span> <span class="n">KP</span><span class="o">.</span><span class="n">capacity</span> <span class="o">&gt;</span> <span class="mi">0</span>
	<span class="o">--</span> <span class="k">for</span> <span class="n">filtering</span> <span class="n">most</span> <span class="n">of</span> <span class="n">the</span> <span class="n">hubs</span> <span class="p">(</span><span class="n">here</span> <span class="ow">not</span> <span class="n">concerned</span> <span class="k">with</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">inputs</span><span class="p">)</span>
	<span class="ow">and</span> <span class="n">P</span><span class="o">.</span><span class="n">cost_inv_fix</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">P</span><span class="o">.</span><span class="n">cap_min</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Example results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="23%" />
<col width="41%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">run_id</th>
<th class="head">vertex_num</th>
<th class="head">process</th>
<th class="head">capacity</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>3599</td>
<td>0</td>
<td>Gas power plant</td>
<td>2462</td>
</tr>
<tr class="row-odd"><td>3600</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-even"><td>3601</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-odd"><td>3602</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-even"><td>3603</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-odd"><td>3604</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-even"><td>3605</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-odd"><td>3607</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-even"><td>3608</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-odd"><td>3609</td>
<td>0</td>
<td>Gas power plant</td>
<td>6154</td>
</tr>
<tr class="row-even"><td>3610</td>
<td>0</td>
<td>District heating plant</td>
<td>10001</td>
</tr>
<tr class="row-odd"><td>3611</td>
<td>0</td>
<td>District heating plant</td>
<td>10000</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-source-vertices-and-their-capacity">
<h4>List source vertices and their capacity<a class="headerlink" href="#list-source-vertices-and-their-capacity" title="Permalink to this headline">¶</a></h4>
<p>Entry level query, join the relevant tables, filter data. Get the source vertices.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Used source vertices.</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_num</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
<span class="kn">from</span> <span class="s2">&quot;source&quot;</span> <span class="k">as</span> <span class="n">S</span>
<span class="n">join</span> <span class="n">vertex</span> <span class="k">as</span> <span class="n">V</span> <span class="n">on</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_id</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">vertex_id</span>
<span class="n">join</span> <span class="n">commodity</span> <span class="k">as</span> <span class="n">C</span> <span class="n">on</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity_id</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">commodity_id</span>
<span class="o">--</span> <span class="k">for</span> <span class="n">view</span><span class="p">,</span> <span class="n">remove</span> <span class="n">where</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4825</span><span class="p">,</span> <span class="mi">4833</span><span class="p">)</span>
<span class="n">where</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4825</span><span class="p">,</span> <span class="mi">4833</span><span class="p">)</span> <span class="ow">and</span> <span class="n">S</span><span class="o">.</span><span class="n">capacity</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">group</span> <span class="n">by</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_num</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">V</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">vertex_num</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Example results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="32%" />
<col width="28%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">run_id</th>
<th class="head">vertex_num</th>
<th class="head">commodity</th>
<th class="head">max</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4825</td>
<td>0</td>
<td>Elec</td>
<td>1748</td>
</tr>
<tr class="row-odd"><td>4825</td>
<td>5</td>
<td>Gas</td>
<td>6229</td>
</tr>
<tr class="row-even"><td>4833</td>
<td>0</td>
<td>Elec</td>
<td>1796</td>
</tr>
<tr class="row-odd"><td>4833</td>
<td>30</td>
<td>Gas</td>
<td>6090</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-count-and-max-capacity-of-built-commodities">
<h4>List count and max-capacity of built commodities<a class="headerlink" href="#list-count-and-max-capacity-of-built-commodities" title="Permalink to this headline">¶</a></h4>
<p>Or what have found a way into pmax (should be built) as a column. Plus show the maximum capacity per.</p>
<p>Show built commodities in a nice, tight manner. Here you can filter the results
with the addition of a <cite>where</cite> clause.</p>
<p>Note <code class="docutils literal"><span class="pre">jsonb_agg</span></code> and <code class="docutils literal"><span class="pre">jsonb_object_agg</span></code> these are over the boundaries of MySQL or such,
but look how convenient they are! (Hooray, <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>!)</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Number of built commodity grids and their maximum capacity.</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">start_ts</span><span class="p">,</span> <span class="n">built_comms</span><span class="p">,</span> <span class="n">comm_cap_max</span>
<span class="kn">from</span> <span class="nn">run</span> <span class="k">as</span> <span class="n">R</span>
<span class="n">join</span> <span class="p">(</span>
<span class="hll">	<span class="n">select</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="n">distinct</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span><span class="p">)</span> <span class="k">as</span> <span class="n">built_comms</span><span class="p">,</span> <span class="n">jsonb_agg</span><span class="p">(</span><span class="n">distinct</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span><span class="p">)</span> <span class="k">as</span> <span class="n">built_names</span>
</span>	<span class="kn">from</span> <span class="nn">pmax</span> <span class="k">as</span> <span class="n">P</span>
	<span class="n">join</span> <span class="n">commodity</span> <span class="k">as</span> <span class="n">C</span> <span class="n">on</span> <span class="n">P</span><span class="o">.</span><span class="n">commodity_id</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">commodity_id</span>
	<span class="n">join</span> <span class="n">edge</span> <span class="k">as</span> <span class="n">E</span> <span class="n">on</span> <span class="n">E</span><span class="o">.</span><span class="n">edge_id</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">edge_id</span>
	<span class="n">where</span> <span class="n">P</span><span class="o">.</span><span class="n">capacity</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span>
	<span class="n">group</span> <span class="n">by</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">builts</span> <span class="n">on</span> <span class="n">builts</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">join</span> <span class="p">(</span>
<span class="hll">	<span class="n">select</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">jsonb_object_agg</span><span class="p">(</span><span class="n">commodity</span><span class="p">,</span> <span class="n">cap_max</span><span class="p">)</span> <span class="k">as</span> <span class="n">comm_cap_max</span>
</span>	<span class="kn">from</span> <span class="p">(</span>
		<span class="n">select</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span> <span class="k">as</span> <span class="n">cap_max</span>
		<span class="kn">from</span> <span class="nn">pmax</span> <span class="k">as</span> <span class="n">P</span>
		<span class="n">join</span> <span class="n">commodity</span> <span class="k">as</span> <span class="n">C</span> <span class="n">on</span> <span class="n">P</span><span class="o">.</span><span class="n">commodity_id</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">commodity_id</span>
		<span class="n">join</span> <span class="n">edge</span> <span class="k">as</span> <span class="n">E</span> <span class="n">on</span> <span class="n">E</span><span class="o">.</span><span class="n">edge_id</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">edge_id</span>
		<span class="n">group</span> <span class="n">by</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span>
		<span class="n">order</span> <span class="n">by</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span>
		<span class="p">)</span> <span class="k">as</span> <span class="n">cap_maxs</span>
	<span class="n">group</span> <span class="n">by</span> <span class="n">run_id</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">json_built</span> <span class="n">on</span> <span class="n">json_built</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">order</span> <span class="n">by</span> <span class="n">start_ts</span> <span class="n">DESC</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Example results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="26%" />
<col width="18%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">run_id</th>
<th class="head">start_ts</th>
<th class="head">built_comms</th>
<th class="head">comm_cap_max</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>5637</td>
<td>2017-09-02 10:47:30</td>
<td>1</td>
<td>{“Gas”: 0, “Elec”: 1646, “Heat”: 0}</td>
</tr>
<tr class="row-odd"><td>5636</td>
<td>2017-09-02 10:46:31</td>
<td>1</td>
<td>{“Gas”: 0, “Elec”: 1537, “Heat”: 0}</td>
</tr>
<tr class="row-even"><td>5635</td>
<td>2017-09-02 10:45:30</td>
<td>2</td>
<td>{“Elec”: 1317, “Heat”: 46}</td>
</tr>
<tr class="row-odd"><td>5634</td>
<td>2017-09-02 10:43:44</td>
<td>1</td>
<td>{“Elec”: 1263, “Heat”: 0}</td>
</tr>
<tr class="row-even"><td>5633</td>
<td>2017-09-02 10:42:50</td>
<td>1</td>
<td>{“Gas”: 0, “Elec”: 1731}</td>
</tr>
<tr class="row-odd"><td>5632</td>
<td>2017-09-02 10:41:54</td>
<td>2</td>
<td>{“Elec”: 1787, “Heat”: 46}</td>
</tr>
<tr class="row-even"><td>5631</td>
<td>2017-09-02 10:39:56</td>
<td>1</td>
<td>{“Elec”: 1029}</td>
</tr>
<tr class="row-odd"><td>5630</td>
<td>2017-09-02 10:38:43</td>
<td>1</td>
<td>{“Elec”: 1114}</td>
</tr>
<tr class="row-even"><td>5629</td>
<td>2017-09-02 10:29:53</td>
<td>2</td>
<td>{“Gas”: 0, “Elec”: 1342, “Heat”: 93}</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="advanced-report">
<h4>Advanced Report<a class="headerlink" href="#advanced-report" title="Permalink to this headline">¶</a></h4>
<p>A more in depth analysis (report) with built capacities with their maximum value, square grid side dimension and edge length plus some parameters which were changed throughout a long run.</p>
<ol class="arabic simple">
<li>Here you can even experience the PostGIS extension in action with length calculation.</li>
<li>Some time filtering</li>
<li>Filtering with the JSONb column. (Very intuitive.)</li>
</ol>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Extensive report.</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">start_ts</span><span class="p">,</span> <span class="n">comm_cap_max</span><span class="p">,</span> <span class="n">vertex_dim</span><span class="p">,</span> <span class="n">edge_max</span><span class="p">,</span> <span class="n">edge_min</span><span class="p">,</span> <span class="n">cost_fix</span><span class="p">,</span> <span class="n">cost_inv_fix</span>
<span class="kn">from</span> <span class="nn">run</span> <span class="k">as</span> <span class="n">R</span>
<span class="n">join</span> <span class="p">(</span>
    <span class="n">select</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">jsonb_object_agg</span><span class="p">(</span><span class="n">commodity</span><span class="p">,</span> <span class="n">cap_max</span><span class="p">)</span> <span class="k">as</span> <span class="n">comm_cap_max</span>
    <span class="kn">from</span> <span class="p">(</span>
        <span class="n">select</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span> <span class="k">as</span> <span class="n">cap_max</span>
        <span class="kn">from</span> <span class="nn">pmax</span> <span class="k">as</span> <span class="n">P</span>
        <span class="n">join</span> <span class="n">commodity</span> <span class="k">as</span> <span class="n">C</span> <span class="n">on</span> <span class="n">P</span><span class="o">.</span><span class="n">commodity_id</span><span class="o">=</span><span class="n">C</span><span class="o">.</span><span class="n">commodity_id</span>
        <span class="n">join</span> <span class="n">edge</span> <span class="k">as</span> <span class="n">E</span> <span class="n">on</span> <span class="n">E</span><span class="o">.</span><span class="n">edge_id</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">edge_id</span>
        <span class="n">where</span> <span class="n">p</span><span class="o">.</span><span class="n">capacity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">--</span> <span class="k">if</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">disabled</span> <span class="n">comm_cap_max</span> <span class="n">will</span> <span class="n">also</span> <span class="n">include</span> <span class="n">Commodities</span> <span class="k">with</span> <span class="mi">0</span> <span class="nb">max</span> <span class="n">Like</span> <span class="n">Gas</span><span class="p">:</span><span class="mi">0</span>
        <span class="n">group</span> <span class="n">by</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span>
        <span class="n">order</span> <span class="n">by</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">cap_maxs</span>
    <span class="n">group</span> <span class="n">by</span> <span class="n">run_id</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">json_built</span> <span class="n">on</span> <span class="n">json_built</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">JOIN</span> <span class="p">(</span>
    <span class="n">select</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">vertex_num</span><span class="p">))</span> <span class="n">AS</span> <span class="n">vertex_dim</span>
    <span class="kn">from</span> <span class="nn">vertex</span> <span class="k">as</span> <span class="n">V</span>
    <span class="n">join</span> <span class="n">run</span> <span class="k">as</span> <span class="n">R</span> <span class="n">on</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span><span class="o">=</span><span class="n">V</span><span class="o">.</span><span class="n">run_id</span>
<span class="hll">    <span class="n">where</span> <span class="n">R</span><span class="o">.</span><span class="n">start_ts</span> <span class="n">BETWEEN</span> <span class="s1">&#39;2017-09-02 08:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span> <span class="n">AND</span> <span class="s1">&#39;2017-09-02 17:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span>
</span>    <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">side_dim</span> <span class="n">on</span> <span class="n">side_dim</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">JOIN</span> <span class="p">(</span>
<span class="hll">    <span class="n">select</span> <span class="n">r</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ST_Length</span><span class="p">(</span><span class="n">geometry</span><span class="p">)))</span> <span class="n">AS</span> <span class="n">edge_max</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ST_Length</span><span class="p">(</span><span class="n">geometry</span><span class="p">)))</span> <span class="n">AS</span> <span class="n">edge_min</span>
</span>    <span class="kn">from</span> <span class="nn">edge</span> <span class="k">as</span> <span class="n">e</span> 
    <span class="n">join</span> <span class="n">run</span> <span class="k">as</span> <span class="n">r</span> <span class="n">on</span> <span class="n">r</span><span class="o">.</span><span class="n">run_id</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">run_id</span>
<span class="hll">    <span class="n">where</span> <span class="n">r</span><span class="o">.</span><span class="n">start_ts</span>  <span class="n">BETWEEN</span> <span class="s1">&#39;2017-09-02 08:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span> <span class="n">AND</span> <span class="s1">&#39;2017-09-02 17:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span>
</span>    <span class="n">group</span> <span class="n">by</span> <span class="n">r</span><span class="o">.</span><span class="n">run_id</span>
    <span class="n">order</span> <span class="n">by</span> <span class="n">edge_max</span><span class="p">,</span> <span class="n">edge_min</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">run_id</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">edge_len</span> <span class="n">on</span> <span class="n">edge_len</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">join</span> <span class="p">(</span>
    <span class="n">select</span> <span class="n">run</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">cost_fix</span><span class="p">,</span> <span class="n">cost_inv_fix</span>
    <span class="kn">from</span> <span class="nn">run</span>
    <span class="n">join</span> <span class="n">commodity</span> <span class="n">AS</span> <span class="n">C</span> <span class="n">on</span> <span class="n">C</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">run_id</span>
<span class="hll">    <span class="n">where</span> <span class="n">run</span><span class="o">.</span><span class="n">start_ts</span>  <span class="n">BETWEEN</span> <span class="s1">&#39;2017-09-02 08:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span> <span class="n">AND</span> <span class="s1">&#39;2017-09-02 17:00:00&#39;</span><span class="p">::</span><span class="n">timestamp</span>
</span>        <span class="ow">and</span> <span class="n">C</span><span class="o">.</span><span class="n">commodity</span> <span class="o">=</span> <span class="s1">&#39;Heat&#39;</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">parameters</span> <span class="n">on</span> <span class="n">parameters</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">run_id</span>
<span class="hll"><span class="n">where</span> <span class="n">comm_cap_max</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;Heat&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">null</span> <span class="ow">and</span> <span class="n">comm_cap_max</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;Heat&#39;</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;0&#39;</span>
</span><span class="n">order</span> <span class="n">by</span> <span class="n">start_ts</span> <span class="n">DESC</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">sqrt(count(vertex_num))</span></code> works here as the stored grids where symmetrical. (6x6, 5x5 etc…)</p>
</div>
<p>Example results:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="17%" />
<col width="22%" />
<col width="11%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">run_id</th>
<th class="head">start_ts</th>
<th class="head">comm_cap_max</th>
<th class="head">vertex_dim</th>
<th class="head">edge_max</th>
<th class="head">edge_min</th>
<th class="head">cost_fix</th>
<th class="head">cost_inv_fix</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>5635</td>
<td>2017-09-02 10:45:30</td>
<td>{“Elec”: 1317, “Heat”: 46}</td>
<td>6</td>
<td>50</td>
<td>50</td>
<td>4</td>
<td>350</td>
</tr>
<tr class="row-odd"><td>5632</td>
<td>2017-09-02 10:41:54</td>
<td>{“Elec”: 1787, “Heat”: 46}</td>
<td>6</td>
<td>50</td>
<td>50</td>
<td>4</td>
<td>350</td>
</tr>
<tr class="row-even"><td>5629</td>
<td>2017-09-02 10:29:53</td>
<td>{“Elec”: 1342, “Heat”: 93}</td>
<td>6</td>
<td>50</td>
<td>50</td>
<td>4</td>
<td>350</td>
</tr>
</tbody>
</table>
<p>After these results, I could say, ok, run <code class="docutils literal"><span class="pre">5635</span></code> looks interesting, I want to re-run it, maybe change some parameter or re-plot or plot it with matplotlib or or or…</p>
<p>I could do something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rivus.io</span> <span class="kn">import</span> <span class="n">db</span> <span class="k">as</span> <span class="n">rdb</span>
<span class="n">engine_string</span> <span class="o">=</span> <span class="s1">&#39;postgresql://postgresql:postgresql@localhost/rivus&#39;</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">engine_string</span><span class="p">)</span>

<span class="n">data_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;process&#39;</span><span class="p">,</span> <span class="s1">&#39;commodity&#39;</span><span class="p">,</span> <span class="s1">&#39;process_commodity&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;area_demand&#39;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">df_name</span><span class="p">:</span> <span class="n">rdb</span><span class="o">.</span><span class="n">df_from_table</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">df_name</span> <span class="ow">in</span> <span class="n">data_dfs</span><span class="p">}</span>
<span class="n">vertex</span> <span class="o">=</span> <span class="n">rdb</span><span class="o">.</span><span class="n">df_from_table</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s1">&#39;vertex&#39;</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>
<span class="n">edge</span> <span class="o">=</span> <span class="n">rdb</span><span class="o">.</span><span class="n">df_from_table</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>

<span class="c1">#... Change whatever parameter I would like ...</span>

<span class="kn">import</span> <span class="nn">pyomo.environ</span>  <span class="c1"># although is not used directly, is needed by pyomo</span>
<span class="kn">from</span> <span class="nn">pyomo.opt.base</span> <span class="kn">import</span> <span class="n">SolverFactory</span>
<span class="kn">from</span> <span class="nn">rivus.utils.prerun</span> <span class="kn">import</span> <span class="n">setup_solver</span>
<span class="kn">from</span> <span class="nn">rivus.main.rivus</span> <span class="kn">import</span> <span class="n">create_model</span>
<span class="c1"># Solve again!</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">hub_only_in_edge</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">SolverFactory</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">])</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">setup_solver</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">log_to_console</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># 3D Re-plot</span>
<span class="kn">from</span> <span class="nn">rivus.io.plot</span> <span class="kn">import</span> <span class="n">fig3d</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">plot</span> <span class="k">as</span> <span class="n">plot3d</span>
<span class="n">plotcomms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">,</span> <span class="s1">&#39;Heat&#39;</span><span class="p">,</span> <span class="s1">&#39;Elec&#39;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">fig3d</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">linescale</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">comms</span><span class="o">=</span><span class="n">plotcomms</span><span class="p">,</span> <span class="n">use_hubs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">dz</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plot3d</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;bunch-{}.html&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">4242</span><span class="p">))</span>

<span class="c1"># Whatever you would like.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="archive-dump-import">
<h2>Archive (Dump - Import)<a class="headerlink" href="#archive-dump-import" title="Permalink to this headline">¶</a></h2>
<p>One can have various reasons to archive a database. For our project a short excerpt of
the detailed <a class="reference external" href="https://www.postgresql.org/docs/current/static/backup.html">official-tutorial</a> is given here.</p>
<p>The bundled tools shipping with <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> are pretty amazing.
In the previous <a class="reference internal" href="#scripts-anchor"><span class="std std-ref">section</span></a> or during <a class="reference internal" href="introduction.html#db-connect"><span class="std std-ref">psql database connection</span></a>
you already used one of them. (<code class="docutils literal"><span class="pre">psql</span></code>)
Now we will get to know <code class="docutils literal"><span class="pre">pg_dump</span></code> and <code class="docutils literal"><span class="pre">createdb</span></code>.</p>
<p>To dump all the contents of a database:</p>
<ol class="arabic">
<li><p class="first">Make sure the database server is running.</p>
</li>
<li><p class="first">Dump the contents into a SQL file.</p>
<blockquote>
<div><ul class="simple">
<li>-U database-user</li>
<li>-f file name to dump to</li>
<li>last parameter without flag is the target database.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">[Optional] Transport the created file to the site, where it should be restored.</p>
</li>
<li><p class="first">Create a database where the restoration should take place.</p>
</li>
<li><p class="first">Restore from file with <code class="docutils literal"><span class="pre">psql</span></code></p>
</li>
</ol>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">pg_ctl</span> <span class="n">status</span>
<span class="n">pg_dump</span> <span class="o">-</span><span class="n">U</span> <span class="n">postgres</span> <span class="o">-</span><span class="n">f</span> <span class="n">rivus_dump</span><span class="mf">.</span><span class="n">sql</span> <span class="n">rivus</span>
<span class="n">createdb</span> <span class="o">-</span><span class="n">h</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">U</span> <span class="n">postgres</span> <span class="n">rivus_import</span>
<span class="n">psql</span> <span class="o">-</span><span class="n">U</span> <span class="n">postgres</span> <span class="n">rivus_import</span> <span class="o">&lt;</span> <span class="n">rivus_dump</span><span class="mf">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>Voilà, you have there you have two local databases, on which you can run super fast queries.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="introduction.html" class="btn btn-neutral" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, lnksz - Havasi Kristof.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>